<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Advanced Spoof Detection</title>

<style>
body {
    background:#0b0d12;
    color:#e6e6e6;
    font-family:system-ui, sans-serif;
    margin:0;
    padding:20px;
}
h1 { text-align:center; }
.grid {
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap:15px;
    margin-top:20px;
}
.card {
    background:#141826;
    border-radius:10px;
    padding:12px;
    font-size:13px;
    box-shadow:0 0 0 1px #2a3042;
}
.card h2 {
    margin:0 0 8px 0;
    border-bottom:1px solid #2a3042;
    padding-bottom:6px;
}
.row {
    display:flex;
    justify-content:space-between;
    border-bottom:1px dashed #2a3042;
    padding:4px 0;
}
.row:last-child { border-bottom:none; }
.good { color:#6bff95; }
.bad { color:#ff5f5f; font-weight:bold; }
small { color:#999; }
</style>
</head>

<body>
<h1>Advanced Navigator & API Spoof Detection</h1>
<small>Red = mismatch â†’ JS-only spoofing</small>

<div class="grid" id="grid"></div>

<script>
/* ---------- helpers ---------- */
async function sha256(str) {
    const buf = new TextEncoder().encode(str);
    const d = await crypto.subtle.digest("SHA-256", buf);
    return [...new Uint8Array(d)].map(b=>b.toString(16).padStart(2,"0")).join("");
}

function canvasFP() {
    const c = document.createElement("canvas");
    c.width = 300; c.height = 80;
    const x = c.getContext("2d");
    x.font="16px Arial";
    x.fillStyle="#f60";
    x.fillRect(0,0,300,80);
    x.fillStyle="#069";
    x.fillText("Canvas FP ðŸ§¬", 10, 40);
    return c.toDataURL();
}

function webglFP() {
    const c = document.createElement("canvas");
    const gl = c.getContext("webgl");
    if (!gl) return "none";
    const dbg = gl.getExtension("WEBGL_debug_renderer_info");
    return dbg
        ? gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL) +
          gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL)
        : "masked";
}

async function uaData() {
    const uad = navigator.userAgentData;
    if (!uad) return null;

    const hi = await uad.getHighEntropyValues([
        "architecture",
        "bitness",
        "model",
        "platform",
        "platformVersion",
        "uaFullVersion",
        "fullVersionList",
        "wow64"
    ]);

    return {
        mobile: uad.mobile,
        brands: uad.brands,
        ...hi
    };
}

/* ---------- MAIN ---------- */
async function collectMain() {
    return {
        env: "Main",
        ua: navigator.userAgent,
        platform: navigator.platform,
        languages: navigator.languages?.join(","),
        mem: navigator.deviceMemory ?? "undef",
        cores: navigator.hardwareConcurrency,
        touch: navigator.maxTouchPoints,
        webdriver: navigator.webdriver,
        tz: Intl.DateTimeFormat().resolvedOptions().timeZone,
        uaData: await uaData(),
        canvas: await sha256(canvasFP()),
        webgl: await sha256(webglFP())
    };
}

/* ---------- WORKER ---------- */
const worker = new Worker("worker.js");
const workerData = new Promise(r => worker.onmessage = e => r(e.data));
worker.postMessage({});

/* ---------- SERVICE WORKER ---------- */
async function collectSW() {
    if (!("serviceWorker" in navigator)) return null;

    await navigator.serviceWorker.register("sw.js");
    await navigator.serviceWorker.ready;

    return new Promise(r => {
        navigator.serviceWorker.addEventListener("message", e => r(e.data), { once:true });
        navigator.serviceWorker.controller?.postMessage({});
    });
}

/* ---------- RENDER ---------- */
function render(envs) {
    const grid = document.getElementById("grid");
    const base = envs[0];

    envs.forEach(env => {
        const card = document.createElement("div");
        card.className="card";
        card.innerHTML=`<h2>${env.env}</h2>`;

        Object.keys(base).filter(k=>k!=="env").forEach(k=>{
            const same = JSON.stringify(env[k]) === JSON.stringify(base[k]);
            card.innerHTML += `
                <div class="row">
                    <span>${k}</span>
                    <span class="${same?"good":"bad"}">
                        ${typeof env[k]==="object"
                            ? `<small>${JSON.stringify(env[k])}</small>`
                            : env[k]}
                    </span>
                </div>`;
        });
        grid.appendChild(card);
    });
}

/* ---------- RUN ---------- */
(async ()=>{
    const main = await collectMain();
    const workerEnv = await workerData;
    const swEnv = await collectSW();

    const envs = [main, workerEnv];
    if (swEnv) envs.push(swEnv);

    render(envs);
})();
</script>
</body>
</html>
