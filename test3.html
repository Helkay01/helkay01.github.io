<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Advanced Environment & Spoof Detection</title>
<style>
    body {
        background: #0d1117;
        color: #c9d1d9;
        font-family: monospace;
        padding: 20px;
    }
    h2 { color: #58a6ff; }
    pre {
        background: #161b22;
        padding: 12px;
        border-radius: 6px;
        overflow-x: auto;
    }
</style>
</head>
<body>

<h2>Main</h2>
<pre id="main"></pre>

<h2>Worker</h2>
<pre id="worker"></pre>

<h2>Service Worker</h2>
<pre id="sw"></pre>

<script>
async function getWebGLInfo(canvasProvider) {
    try {
        const canvas = canvasProvider();
        const gl = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
        if (!gl) return { vendor: "unavailable", renderer: "unavailable" };

        const dbg = gl.getExtension("WEBGL_debug_renderer_info");
        if (!dbg) return { vendor: "masked", renderer: "masked" };

        return {
            vendor: gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL),
            renderer: gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL)
        };
    } catch {
        return { vendor: "error", renderer: "error" };
    }
}

async function getUAData() {
    if (!navigator.userAgentData) return {};
    return await navigator.userAgentData.getHighEntropyValues([
        "architecture",
        "bitness",
        "model",
        "platform",
        "platformVersion",
        "uaFullVersion",
        "fullVersionList",
        "wow64"
    ]);
}

async function collectMain() {
    const webgl = await getWebGLInfo(() => document.createElement("canvas"));
    const uach = await getUAData();

    return {
        ua: navigator.userAgent,
        platform: navigator.platform,
        languages: navigator.languages?.join(","),
        mem: navigator.deviceMemory ?? "undef",
        cores: navigator.hardwareConcurrency ?? "undef",
        touch: navigator.maxTouchPoints ?? 0,
        webdriver: navigator.webdriver ?? false,
        tz: Intl.DateTimeFormat().resolvedOptions().timeZone,
        webgl_vendor: webgl.vendor,
        webgl_renderer: webgl.renderer,
        ua_ch: uach
    };
}

(async () => {
    const mainData = await collectMain();
    document.getElementById("main").textContent =
        JSON.stringify(mainData, null, 2);

    // Worker
    const worker = new Worker("worker.js");
    worker.onmessage = e => {
        document.getElementById("worker").textContent =
            JSON.stringify(e.data, null, 2);
    };

    // Service Worker
    if ("serviceWorker" in navigator) {
        const reg = await navigator.serviceWorker.register("sw.js");
        navigator.serviceWorker.addEventListener("message", e => {
            document.getElementById("sw").textContent =
                JSON.stringify(e.data, null, 2);
        });

        if (navigator.serviceWorker.controller) {
            navigator.serviceWorker.controller.postMessage("collect");
        } else {
            navigator.serviceWorker.ready.then(() => {
                navigator.serviceWorker.controller?.postMessage("collect");
            });
        }
    }
})();
</script>

</body>
</html>
